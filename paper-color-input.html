<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-form-element-behavior/iron-form-element-behavior.html">
<link rel="import" href="../paper-input/paper-input-container.html">
<link rel="import" href="paper-color-picker.html">
<link rel="import" href="ustudio-color-behavior.html">

<!--
This component contains 3 elements:

 - `<paper-color-circle>` : An element drawing a color space onto a canvas
 - `<paper-color-picker>` : An element containing a material design picker dialog for colors
 - `<paper-color-input>` : An element that displays an input that allows changing of the color through a color picker dialog.

Shape and colour spaces
---
There are three different main configurations all 3 elements allow: `circle`, `square`
 or `huebox`. This is called the `[shape]` of the color circle. Additionally in the case of `circle` and `square` it can
  be specified whether the colours should be generated from the `hsv` or `hsl` colour space.

    <paper-color-input shape="square" type="hsl"></paper-color-input>


@demo demo/index.html
-->

<dom-module id="paper-color-input">
  <template>
    <style>
      #color-preview {
        height: 16px;
        width: 16px;
        border: 1px solid rgba(0, 0, 0, 0.1);
        border-radius: 1px;
        margin: 2px;
        position: relative;
        background-image: linear-gradient(to right, #ffffff 1%,#ffffff 50%,#eee 50%,#eee 100%), linear-gradient(to right, #eee 1%,#eee 50%,#ffffff 50%,#ffffff 100%);
        background-size: 16px 8px,  16px 8px;
        background-repeat: repeat-x, repeat;
      }

      #color {
        position: absolute;
        left: 0;
        top: 0;
        right: 0;
        bottom: 0;
      }

      #input {
        cursor: pointer;
      }

      span.dark {
        font-size: 11px;
        color: rgba(0, 0, 0, 0.8);
        font-family: monospace;
        text-transform: uppercase;
      }
    </style>

    <paper-input-container id="input" always-float-label>

      <label>[[ label ]]</label>

      <div class="paper-input-input">
        <span>{{ name }}</span>&nbsp;<span
          hidden$="{{ !withDescription }}" class="dark">
          {{ hex }}
        </span>
      </div>

      <div id="color-preview" suffix>
        <div id="color" style$="[[ backgroundStyle ]]"></div>
      </div>

    </paper-input-container>

    <paper-color-picker
      id="picker"
      red="{{ red }}"
      green="{{ green }}"
      blue="{{ blue }}"
      name="{{ name }}"
      shape="{{ shape }}"
      type="{{ type }}"
      hex="{{ hex }}"
      alpha="{{ alpha }}"
      allow-alpha="{{ allowAlpha }}"
      always-show-alpha="{{ alwaysShowAlpha }}"></paper-color-picker>

  </template>

  <script>
    Polymer({

      is: 'paper-color-input',

      behaviors: [
        uStudio.ColorBehavior
        // disabled till https://github.com/Polymer/polymer/issues/3167 gets fixed
        // Polymer.IronFormElementBehavior
      ],

      properties: {
        /**
         * The label for this input.
         *
         * @attribute label
         * @type String
         * @default ''
         */
        label: {
          type: String,
          value: ''
        },

        /**
         * *square*, *circle* or *huebox*
         *
         * @attribute shape
         * @type string
         * @default 'circle'
         */
        shape: {
          type: String,
          value: 'circle',
          notify: true
        },

        /**
         * *hsv* or *hsl*
         *
         * @attribute type
         * @type string
         * @default 'hsv'
         */
        type: {
          type: String,
          value: 'hsv',
          notify: true
        },

        /**
         * Whether to allow changing the transparency of the picked color
         */
        allowAlpha: {
          type: Boolean,
          value: false
        },

        /**
         * Whether to show the color also as a string
         */
        withDescription: {
          type: Boolean,
          value: false
        },

        /**
         * Show alpha slider always instead of only in the advanced settings
         */
        alwaysShowAlpha: {
          type: Boolean,
          value: false
        }
      },

      listeners: {
        'input.tap': 'openColorPicker',
        'immediate-color-changed': '_setName'
      },

      _setName: function () {
        this.set('name', this.$.picker.name);
        this.$.picker.setColor();
      },

      openColorPicker: function () {
        this.$.picker.open();
      }

    });
  </script>
</dom-module>
