<!doctype html>

<html>
<head>
  <meta charset="UTF-8">
  <title>paper-color-picker test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../web-component-tester/browser.js"></script>
  <script src="../../iron-test-helpers/test-helpers.js"></script>
  <script src="../../iron-test-helpers/mock-interactions.js"></script>

  <link rel="import" href="../paper-color-picker.html">
</head>
<body>

  <test-fixture id="picker">
    <template>
      <paper-color-picker
        entry-animation="transform-automation"
        exit-animation="transform-automation"
        hex="#EF5323"
      ></paper-color-picker>
    </template>
  </test-fixture>

  <script>

    function runAfterOpen (dialog, callback) {
      dialog.addEventListener('iron-overlay-opened', callback);
      dialog.open();
    }

    suite('state management', function () {
      this.timeout(2500);

      var element;
      var cancelSpy;
      var acceptSpy;
      var resetSpy;

      setup(function () {
        element = fixture('picker');
        cancelSpy = sinon.spy();
        acceptSpy = sinon.spy(element, 'acceptChanges');
        resetSpy = sinon.spy(element, 'resetState');
        element.addEventListener('iron-overlay-canceled', cancelSpy);
      });

      test('canceling changes resets state', function (done) {
        runAfterOpen(element, function () {
          MockInteractions.tap(Polymer.dom(element.root).querySelector('[dialog-dismiss]'));
          assert(cancelSpy.called, 'cancel event did not fire');
          assert(resetSpy.called, 'resetState was not called');
          assert(acceptSpy.notCalled, 'changes were applied');
          done();
        });
      });

      test('accepting changes preserves state', function (done) {
        runAfterOpen(element, function () {
          MockInteractions.tap(Polymer.dom(element.root).querySelector('[dialog-confirm]'));
          assert(cancelSpy.notCalled, 'cancel event fired');
          assert(resetSpy.notCalled, 'resetState was called');
          assert(acceptSpy.called, 'changes were not applied');
          done();
        });
      });

    });
  </script>

</body>
</html>
