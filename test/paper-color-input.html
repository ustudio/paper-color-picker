<!doctype html>

<html>
<head>
  <meta charset="UTF-8">
  <title>paper-color-input test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../web-component-tester/browser.js"></script>
  <script src="../../iron-test-helpers/test-helpers.js"></script>
  <script src="../../iron-test-helpers/mock-interactions.js"></script>

  <link rel="import" href="../../polymer/polymer.html">
  <link rel="import" href="../paper-color-input.html">
  <link rel="import" href="fixtures/input-host-element.html">
</head>
<body>

  <test-fixture id="default">
    <template>
      <paper-color-input></paper-color-input>
    </template>
  </test-fixture>

  <test-fixture id="hex">
    <template>
      <input-host-element value="#000000"></input-host-element>
    </template>
  </test-fixture>

  <script>
    describe('basic functionality', function () {

      context('defaults', function () {
        it('should set default values', function () {
          var element = fixture('default');

          expect(element.label).to.be.empty;
          expect(element.shape).to.equal('circle');
          expect(element.type).to.equal('hsb');
          expect(element.showAlpha).to.be.false;
          expect(element.alwaysShowAlpha).to.be.false;
          expect(element.withDescription).to.be.false;
          expect(element.withBackdrop).to.be.false;
          expect(element.description).to.equal('#');
          expect(element.red).to.be.NaN;
          expect(element.green).to.be.NaN;
          expect(element.blue).to.be.NaN;
          expect(element.hue).to.be.undefined;
          expect(element.saturation).to.be.undefined;
          expect(element.luminosity).to.be.undefined;
          expect(element.brightness).to.be.undefined;
          expect(element.alpha).to.equal(1);
        });
      });

      context('label', function () {
        it('should allow you to set the label', function () {
          var element = fixture('default');

          element.label = 'Select a color';
          var label = Polymer.dom(element.root).querySelector('label');
          expect(label.innerHTML).to.equal(element.label);
        });
      });

      context('clicking OK after changing the hex value', function() {
        var hexChanges;
        var element;
        var input;
        var confirm;

        function valueChanged(event) {
          hexChanges.push(event.detail.value);
        };

        beforeEach(function(done) {
          hexChanges = [];
          element = fixture('hex');
          input = element.$.input;
          confirm = Polymer.dom(input.$.picker.root).querySelector('[dialog-confirm]');

          element.addEventListener('value-changed', valueChanged);

          //MockInteractions.tap(input);
          input.openColorPicker();
          flush(function() {
            input.$.picker.$['hex-input'].value = '#111445';
            flush(function() {
              //MockInteractions.tap(confirm);
              confirm.click();
              flush(function() {
                done();
              });
            });
          });
        });

        it('should enable two-way binding of hex property', function() {
          expect(element.value).to.equal('#111445');
        });

        it('should change the hex value exactly once', function() {
          expect(hexChanges).to.deep.equal(['#111445']);
        });

        it('should update the color preview', function() {
          expect(input.$['color-preview'].querySelector('#color').style['background-color']).to.equal('rgb(17, 20, 69)');
        });
      });

    });
  </script>

</body>
</html>
